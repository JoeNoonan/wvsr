# Select key identifying columns
key_columns <- c("COUNTRY_ALPHA", "S002VS")

# Ensure key columns exist
if (!all(key_columns %in% names(wvs_data))) {
  stop("Dataset must contain 'COUNTRY_ALPHA' and 'S002VS' columns.")
}

# Select all variables except key columns
key_columns <- c("COUNTRY_ALPHA", "S002VS")
question_columns <- setdiff(names(wvs_data), key_columns)

# Reshape the data to long format to check availability
coverage_data <- wvs_data %>%
  dplyr::select(all_of(c(key_columns, question_columns))) %>%
  dplyr::distinct() %>%
  tidyr::pivot_longer(cols = -all_of(key_columns),
                      names_to = "variable_name",
                      values_to = "response") %>%
  dplyr::mutate(available = !is.na(response)) %>%
  dplyr::select(COUNTRY_ALPHA, S002VS, variable_name, available) %>%
  dplyr::arrange(COUNTRY_ALPHA, S002VS, variable_name)

# Merge with variable labels to include question descriptions
coverage_data <- coverage_data %>%
  dplyr::left_join(variable_labels, by = "variable_name") %>%
  dplyr::rename(country = COUNTRY_ALPHA, year = S002VS)

return(coverage_data)